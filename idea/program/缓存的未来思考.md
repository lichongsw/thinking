# 为啥最近流行缓存这么个东西

近几年缓存这个东西可谓发展的如火如荼，都快到了你不用被人就会质疑的地步。细节就不讲了，这两篇是从两个不同的视角来总结缓存的现状，写的都很工整有参考意义。

[缓存的非技术视角的总结]: https://mp.weixin.qq.com/s/br5KvFXlgxiADwi9Xv0nbw
[缓存的技术总结]: https://developer.aliyun.com/article/728028?spm=a1z389.11499242.0.0.65452413JPs6l3&amp;utm_content=g_1000089486



从小公司的单机缓存到Twitter[105TB RAM, 39MM QPS, 10,000+ Instances ](http://highscalability.com/blog/2014/9/8/how-twitter-uses-redis-to-scale-105tb-ram-39mm-qps-10000-ins.html)的超大分布式缓存集群，这个大小通吃的规模简直是神奇了。一句话，缓存解决的痛点就是降低客户请求响应时间。不管是规模大小，只要做到两点。一是能够提前准备好用户需要的数据，而是把数据放在离用户比较近的地理位置。成熟的市场里用户用脚投票，体验流畅就能够吸引到用户。

在ToC为主的这10年（2010~2020）由于用户巨大的规模以及高度集中的使用习惯，真的倒逼技术日新月异的进步，使得互联网行业的知识更新速度远远超出实体行业。但毕竟这个行业不是实体行业，原生的创造产品并不多，大部分公司都是用流量来抽水的。比较少数互联网公司自己生产产品。例如手机厂商，云服务运营商，原创游戏动漫影视工作上，原创知识杂志新媒体等生产出消费者感兴趣而且愿意付费的实体或者虚拟产品。



我始终信奉一个原则，技术是需求驱动的，也没有单纯技术驱动的伟大公司。如果真有人把ToC做到极致，拥有全球60亿用户后会如何？虽然目前还没有这样的产品，但有些公司已经在10亿这个数量级把用户服务的挺不错了。那么没有更大规模的需求，相关技术进步的驱动力在哪里呢？



# 那未来会有什么趋势

远的不说，随着我大中国技术实力的提升，5~10年内必定会把存储芯片价格压下来。4G和5G网络基础设施接下来一定会做到全覆盖，并提供足够高效的带宽。有了这些基础之后数据的格局会不会有些新的变化呢？可以先自己想想可能对哪些方面有影响，再往下看。

不要不相信趋势的力量，例如面板行业格局的改变者的京东方。我印象非常深刻的一件事就是2011年买43寸的电视机的时候国产创维4300，外资三星7000。2019年小米55寸1400到手，外资基本上已经被踢出局了。个人思考过几个方向：

1. 资源型缓存。如果内存足够便宜了，那以后的消费端搞不好普遍都是大内存了。不说远的，2020年预计手机8G起步，个人PC16G（2019年11月金士顿32GDDR4价格就519RMB，1年半前还TMD1600+的）起步。服务器这种量比较大的应该更加便宜，搞不好真128G起步了。等到消费端内存的性价比足够高了，是不是缓存以后就会往本地化发展呢？说实际点，直播软件中的视频的预加载就是这样的用例。在你的每一步操作中，系统都会预测你接下来可能用到的几个视频先帮你弄到本地来，争取在服务端和客户端都做到预分配资源不需要接触磁盘。服务端如果直接在内存中保留10w热点视频的预读数据，100000*10M=1TB也没有多大的运营成本。这跟Twitter直接缓存用户即将要拉取的消息本质上都是为了快速响应，只不过Twitter的消息要从数据库取出来，视频数据要从硬盘读出来。客户端本地要是还要优化也可以弄个100M的额外内存池来存放接下来最有可能用到的10个视频，每个10M就可以存上10秒了。只要做到快速跟进用户输入（文字，语音搜索，滑动屏幕等）并主动更新这10 个视频，基本上可以做到秒开就像看本地视频一样。即使用户操作再快，从屏幕上出现用户想看的视频到用户主动点击播放也是有时间差的。现在的免费生态好多点开视频先给你放个60秒钟的本地广告，这种就更没啥事了。如果优化服务只提供给付费用户，那预加载增加的系统负载就小多了。

2. 计算型服务端缓存。这一类需要在服务端计算的数据对存储的容量要求并不高，因为数据量是比较小的。基本上需要动态交互的消费端就那么一些，例如各种商业交易活动，价格的更新，打车软件车辆位置等等。键值对和文档数据库基本上都是内存型的，响应基本上与规模是线性的，一般是没啥性能问题。目前主流的关系数据库大多还是偏持久化这么个格局导致复杂的业务中响应速度是不够的。不是关系型内存数据库不给力，而是推广和产业发展需要时间。 可以看看这个轻量级的分布式的内存计算架构平台[ignite](https://ignite.apache.org/whatisignite.html), 这个还内置键值对和关系型内存数据库呢。如果推广开来并得到足够规模的实战验证，好多各种各样的轮子都不再需要了。

3. 资源+计算型缓存。google最近在北美，加拿大，英国，欧洲几个地区推出的云游戏不就是这个类型嘛，服务端后台计算生产游戏帧，然后推给用户。就是不知道这个商业模式能不能够成功，但还是希望google能够做成的，毕竟从体验和技术上讲都是一次很大的变革。以前只有卡牌或者低频游戏是服务端全程计算完后给结果到客户端，然后客户端根据结果来完成帧渲染。大型3A游戏操作要做到低延时那可不是随随便便能够搞的了。要知道客户端输入的是一条指令的小包，服务端输出的可是一帧帧高品质的画面。对服务端来说这个可是上传大量数据到客户端，是高上行网速。就不说国内的带宽了，运营商给你的家用带宽都是下行高，上行要慢一个数量级的。加上一点个人理解，google做这个可不是只为了游戏。如果连高画质极度灵敏的3A大作都可以这么干，那你想想PC上的桌面软件是不是更轻松呢？这可是一种颠覆性的概念，以后公网都可以做到只有云主机，键鼠和显示器。在足够好的网络上，依靠硬件高出勤率来服务多租户的场景还是很有市场的。不管google挑战行业格局是否能够成功，这终究会比特币那些同样消耗机器和电力资源的行为有意义一些。万一google真把这事做成了，以后电脑配置估计没有上限可以实时调整了。直接按使用量阶梯收钱是不是很有意思。

4. 业务型缓存。这个业务特征非常显著的一类应用都拥有超高命中率的缓存系统，对缓存容量不敏感。来来回回读写那几个比较集中的数据的应用而且命中率达到2个9，这种即使内存再便宜也影响不到啥。即使扩大缓存10倍的容量，命中从99%提升到99.5%这种生意只有会考虑的。

   

# 行业变化

近年来ToC的发展已经减缓，甚至一度出现手机出货量下降的趋势。随着移动互联网的普及程度提高，人口红利快消失了，以后的存量竞争中不知道这些大获全胜的头部企业是否有动力去更改缓存的使用方式。ToB的发展已经开启，传统行业的互联网化应该是下一个增长点。例如工业4.0，物联网，机器人，智能制造，驾驶辅助等等确实会提高生产力。那这些行业跟缓存的关系如何呢？
TODO:待以后有空补充
